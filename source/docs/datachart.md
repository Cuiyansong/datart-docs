---
title: 数据图表
---

数据图表是 datart 可视化的基础单元；通过对数据视图中的字段做可视化属性配置，将查询结果进行可视化编码，最终以图表的形式展现

数据图表可以在可视化功能的目录树中创建，也可以在仪表板中直接创建。在目录树中创建的数据图表称作`公共数据图表`，可以独立展示、也可以被多个仪表板引用，与仪表板共同显示在目录树中；在仪表板中直接创建的数据图表称为`专有数据图表`，仅能与所属仪表板一起展示

在主导航栏点击`可视化`菜单，点击`目录`顶部的加号按钮创建公共数据图表

![概述-1](/datart-docs/images/datachart/0-1-1.png)

填写名称、描述、选择所属目录，点击保存之后，一个空数据图表已完成创建

![概述-2](/datart-docs/images/datachart/0-1-2.png)

点击目录上新建的数据图表，右侧区域会显示它的浏览界面，点击右上角的编辑按钮进入图表编辑器

![概述-3](/datart-docs/images/datachart/0-1-3.png)

# 1. 编辑图表

编辑器从布局上分为 3 部分：

- 左侧：关联数据视图的字段列表，用于拖拽到配置区`数据`栏中进行可视化属性配置
- 中部：配置区
- 右侧：预览区，用于选择图表类型和预览图表

![编辑图表](/datart-docs/images/datachart/1-1-1.png)

## 1.1 字段列表

在左上角的下拉菜单中关联数据视图，所选数据视图的字段列表会展示在左侧面板上，不同字段类型有不同的前缀图标，`字符`和`日期`型显示为蓝色，`数值`型显示为绿色

### 1.1.1 计算字段

点击字段列表顶部的加号按钮，可以创建计算字段

![计算字段-1](/datart-docs/images/datachart/1-1-1-1.png)

创建一个计算字段需要填写名称、类型和表达式；在中部的编辑器内编写表达式，计算字段的表达式仅允许包含以下内容：

- 字段名称：表达式中所使用的字段名称格式为 `[字段名称]`，点击左侧字段列表中的字段，会自动添加字段名称到编辑器光标所在处
- 函数：datart 内置了 55 个通用函数，已分好类、在右侧以列表展示，点击函数名称会自动添加到编辑器光标所在处。在编辑器中光标移动到函数名称上时，下方会提示函数简介和语法。另外，datart 未支持的通用函数、但数据源的 SQL 语法可以支持的，开发者也可以写到表达式中
- 运算符：支持 `+` `-` `*` `/` 等常规 SQL 运算符
- 变量：_（开发中）_

未按标准书写的表达式在保存时会提示错误。保存成功后，计算字段显示为橙色，可以像使用常规字段一样拖拽计算字段到`数据`配置栏中

![计算字段-2](/datart-docs/images/datachart/1-1-1-2.png)

## 1.2 数据

将字段拖拽到数据配置栏中，来确定图表的数据来源。数据配置变化会触发重新查询

### 1.2.1 维度和指标

datart 没有预定义维度和指标，而是通过图表提供的数据配置项类型来对字段进行处理，配置项详情可以参考[自定义图表插件](chart_plugin)章节。其中`维度`型配置项会对拖入的字段做分组处理，`指标`型配置项会对拖入的字段做聚合处理。

![维度和指标](/datart-docs/images/datachart/1-2-1-1.png)

指标配置项支持在下拉菜单中对拖入的字段设置：

- 聚合方式：
  - 数值型字段支持 `总计`、`平均值`、`计数`、`去重计数`、`最大值`、`最小值` 6 种聚合方式
  - 字符和日期型字段支持 `计数`、`去重计数` 2 种聚合方式
  - 如果拖入的计算字段为数值型、并且表达式里已经包含聚合函数的情况下，是无法在下拉菜单中选择聚合方式的
- 数值格式：
  - 默认格式
  - 数值：可以设置小数位数、单位和千分位分隔
  - 货币：可以设置小数位数、单位和千分位分隔
  - 百分比：可以设置小数位数
  - 科学型：可以设置小数位数
- 着色：部分图表支持设置指标数据在图表上显示的颜色，优先级低于着色配置项

#### 1.2.1.1 钻取设置

部分图表支持钻取交互能力。钻取需要在图表配置里记录一组维度字段，这一组字段将按照添加顺序自动构成钻取路径，在预览图表时通过左键点击或右键菜单来对当前展示的维度进行筛选、并进入到路径中下一个维度查看数据。通常情况下，这一组维度字段具有层次结构，来满足层层递进探索数据的目的

支持钻取的图表，在配置界面上会拥有一个“可钻取”的维度配置项，支持拖入多个字段，默认情况下将首个字段的值作为图表维度进行展示。

可以直接拖拽层次结构名称到可钻取的维度栏上，效果同批量拖拽字段一样，但展示为层次结构让字段关系更为清晰，交互上也更方便

![钻取设置-1](/datart-docs/images/datachart/1-2-1-2.png)
![钻取设置-2](/datart-docs/images/datachart/1-2-1-3.png)

钻取功能的使用请参考[图表交互](datachart#2-1-图表交互)章节

### 1.2.2 筛选

筛选配置项支持拖入任意字段，不同的字段类型配置面板有所差别，支持将筛选字段以控制器形式展示出来供用户操作

#### 1.2.2.1 字符型字段筛选

字符型字段默认情况下支持以下方式配置筛选：

- 常规：即时查询字段去重值作为筛选项

  - 支持在筛选项里选择一到多项作为默认值
  - 支持单选按钮、单/多选下拉菜单作为控制器，取决于默认值数量

  ![字符型字段筛选-1](/datart-docs/images/datachart/1-2-2-1-1.png)

- 自定义：手动添加筛选项

  - 支持快捷选择字段去重值添加到筛选项
  - 支持拖拽改变筛选项顺序
  - 支持在筛选项里选择一到多项作为默认值
  - 支持单选按钮、单/多选下拉菜单作为控制器，取决于默认值数量

  ![字符型字段筛选-2](/datart-docs/images/datachart/1-2-2-1-2.png)

- 条件：配置一个条件表达式作为筛选默认值

  - 仅支持文本输入框作为控制器

  ![字符型字段筛选-3](/datart-docs/images/datachart/1-2-2-1-3.png)

在选择了`聚合方式`的情况下，字符型字段将转换为数值型字段参与筛选

![字符型字段筛选-4](/datart-docs/images/datachart/1-2-2-1-4.png)

#### 1.2.2.2 数值型字段筛选

数值型字段支持以下方式配置筛选：

- 区间：填写一个范围作为筛选默认值

  - 支持数值范围和滑块作为控制器

  ![数值型字段筛选-1](/datart-docs/images/datachart/1-2-2-2-1.png)

- 条件：配置一个条件表达式作为筛选默认值

  - 仅支持数值输入框作为控制器

  ![数值型字段筛选-2](/datart-docs/images/datachart/1-2-2-2-2.png)

无论是否选择`聚合方式`，数值型字段始终作为数值参与筛选

#### 1.2.2.3 日期型字段筛选

日期型字段支持以下方式配置筛选：

- 推荐：快捷选项，选定一个常用的时间范围

  ![日期型字段筛选-1](/datart-docs/images/datachart/1-2-2-3-1.png)

- 手动：手动选择一个时间范围；可以选择精确或是相对时间

  ![日期型字段筛选-2](/datart-docs/images/datachart/1-2-2-3-2.png)

日期型字段仅支持日期范围作为控制器

#### 1.2.2.4 是否可见

隐藏：不使用控制器改变筛选值，仅默认值生效

显示：需要选择展示用的控制器，在图表预浏览面，查看用户可以通过操作控制器来改变筛选条件

条件：在图表里有 1 个及以上字符型字段参与筛选时，新建筛选时可以选择 1 个字符型筛选作为自身可见与否的依赖条件，当依赖的筛选值满足表达式时才会显示控制器

![是否可见](/datart-docs/images/datachart/1-2-2-4-1.png)

#### 1.2.2.5 控制器

控制器是筛选在图表浏览界面的可视化展示，通过预定义的控制器形式，用户可以自行更改筛选值来动态查询数据。数据图表的控制器集中展示在图表上方

datart 数据图表支持以下类型控制器：

- 字符：多选下拉菜单、单选下拉菜单、单选按钮、文本输入框

![控制器-1](/datart-docs/images/datachart/1-2-2-5-1.png)

- 数值：数值范围、滑块、数值输入框

![控制器-2](/datart-docs/images/datachart/1-2-2-5-2.png)

- 日期：日期范围

![控制器-3](/datart-docs/images/datachart/1-2-2-5-3.png)

可以在配置界面设置控制器宽度，默认情况下自适应展示

### 1.2.3 着色

着色配置项支持放入一个字段来对图表做颜色可视化编码，目前仅支持拖入字符型字段。

当拖入字符型字段时，字段会被作为`维度`进行分组，图表会依据字段值和预设的颜色分成多系列进行展示，图例中会展示系列与颜色详情

![着色](/datart-docs/images/datachart/1-2-3-1.png)

### 1.2.4 其他

- 信息：部分直角坐标系图表支持，只能放置数值型字段，拖入的字段会被当做`指标`做聚合处理
- 尺寸：用于散点图和气泡地图做节点大小编码，拖入的字段会被当做`指标`做聚合处理

### 1.2.5 字段设置

可以点击拖入数据配置项的字段，在下拉菜单中对字段进行设置，目前支持以下通用设置：

- 别名：改变字段在图表上的显示名称
- 排序：对字段值进行排序，选项为：
  - 默认：即不排序
  - 升序
  - 降序

## 1.3 样式

样式配置栏与图表相关，用于改变图表的展示规则。样式配置变化不会触发查询

## 1.4 分析

分析栏中包含一些与数据分析相关的配置选项

### 1.4.1 分页

表格支持在分析栏中启用分页和设置每页行数

### 1.4.2 总行数

除表格外的其他图表都可以在分析栏中设置总行数，用于限制图表展示的数据总量

### 1.4.3 参考线

可以给部分直角坐标系图表设置参考线和参考区间，目前仅支持折线图、面积图、柱状图、散点图和双 Y 轴图

参考线需要关联到 1 个指标，数值可以选择关联指标的最大值、最小值、平均值，也可以选择手动设置常量值

参考区间需要设置起始值和结束值，每个值分别需要关联 1 个指标，数值可以选择关联指标的最大值、最小值、平均值，也可以选择手动设置常量值

### 1.4.4 汇总列、总计、小计

表格支持在分析栏中设置汇总列；汇总列只能是数值字段

透视表支持在分析栏中开启行总计、列总计和小计

## 1.5 交互

部分图表可以在交互栏设置“跳转”和“查看数据”两种交互行为

### 1.5.1 跳转

配置了跳转交互之后，在图表中触发跳转时，浏览器会跳转到目标页面，并通过携带的 url 参数对目标页面进行数据筛选

勾选左侧选框启用跳转设置，点击标题打开配置面板

![跳转-1](/datart-docs/images/datachart/1-5-1.png)
![跳转-2](/datart-docs/images/datachart/1-5-2.png)

datart 支持设置 3 种目标页面类型，不同类型接收参数和筛选的方式不一样

1. 图表

跳转到图表时，通过 URL 上的参数对目标图表的数据视图字段进行筛选、或对变量进行赋值

2. 仪表板

跳转到仪表板时，会匹配与 URL 参数名称相同的控制器，将参数值赋给控制器作为默认值

3. URL

跳转到 URL 无法控制参数的使用

每个图表可以创建多条跳转规则，每一条跳转规则需要设置以下内容：

- 名称
- 类型：跳转目的地类型
  - 跳转到图表
  - 跳转到仪表板
  - 跳转到 URL
- 交互事件：触发交互行为的事件
  - 左键单击：鼠标左键点击触发
  - 右键菜单：打开鼠标右键菜单，通过选择菜单中的选项触发
- 打开方式
  - 从当前页打开：改变浏览器地址，重定向到目标页
  - 打开新窗口：从浏览器新窗口打开目标页
  - 打开对话框：从弹窗中打开目标页
- 关系设置：不同的跳转类型关系设置不一样：
  - 跳转到图表：需要设置当前图表与目标图表之间的字段关联关系；选项如下：
    - 自动：按字段名称自动匹配，触发跳转时，会将当前图表中已作用的所有筛选条件，通过字段名称匹配传递到目标图表
    - 自定义：手动配置字段关系，触发跳转时，仅将满足配置关系的筛选条件传递到目标图表
  - 跳转到仪表板：需要设置当前图表与目标仪表板控制器之间的关联关系；触发跳转时，会将符合匹配关系的筛选条件值传递给目标仪表板控制器作为默认值
  - 跳转到 URL：需要设置当前图表与目标地址 URL 参数的匹配关系；触发跳转是，会将符合匹配关系的筛选条件值赋给目标地址对应的 URL 参数

### 1.5.2 查看数据

启用了查看数据配置之后，在图表中触发查看数据时，会弹窗展示所选择图表元素的汇总数据和明细数据

勾选左侧选框启用查看数据，点击标题打开配置面板

![查看数据-1](/datart-docs/images/datachart/1-5-3.png)
![查看数据-2](/datart-docs/images/datachart/1-5-4.png)

需要配置以下内容：

1. 交互事件：触发交互行为的事件

- 左键单击：鼠标左键点击触发
- 右键菜单：打开鼠标右键菜单，通过选择菜单中的选项触发

2. 选择字段：选择需要展示的字段

# 2. 预览图表

配置图表时可以在编辑器右侧即时预览图表，可以选择预览区域上方的小图标切换图表；鼠标悬停到图标上可以查看该图表正常展示所需的条件

![预览图表-1](/datart-docs/images/datachart/2-1-1.png)

在预览区的右上角，可以点击切换图表 -> 原始数据 -> SQL 语句

![预览图表-2](/datart-docs/images/datachart/2-1-2.png)

![预览图表-3](/datart-docs/images/datachart/2-1-3.png)

## 2.1 图表交互

一个图表可以同时拥有钻取、跳转、查看数据多种交互行为；下面是一些通用交互规则：

- 默认情况下，左键点击为选择图表元素；可以按住 Command / Ctrl 键来多选
- 如果有多个交互行为都使用左键单击作为触发事件，那么在左键单击时都会触发。如果一个图表包含多个交互行为，建议将交互事件都设为右键菜单

### 2.1.1 钻取

支持钻取的图表，点击右键菜单可以看到以下 3 个选项

- 显示下一层级：使用钻取路径中的下一个维度来替换当前维度展示图表
- 展开下一层级：将钻取路径中的下一个维度与当前维度合并展示图表
- 开启“点击下钻”：点击启用之后，左键点击图表元素将视为同时触发以下 2 个行为：

  1. 以该元素的维度值作为筛选条件
  2. 显示下一层级

![钻取-1](/datart-docs/images/datachart/2-1-4.png)

当钻取到下一层级时，可以通过图表左下角的钻取路径导航、或是右键菜单的“上卷”选项来回到上一级

![钻取-2](/datart-docs/images/datachart/2-1-5.png)

### 2.1.2 跳转、查看数据

如果配置了跳转或查看数据行为在左键单击，那么点击图表元素时会立即触发行为；如果配置在右键菜单，当选择图表元素之后打开右键菜单，可以看到跳转和查看数据的选项

![跳转-1](/datart-docs/images/datachart/2-1-6.png)

触发跳转时，如果没有配置关系，或配置的关系未生效，依然会跳转到目标地址，但不携带任何参数

# 3. 基础功能

## 3.1 新建

点击目录树顶部的加号按钮，选择“新建数据图表”或“新建目录”会弹出新建表单，填写名称和所属目录即可完成创建

![新建](/datart-docs/images/datachart/3-1-1.png)

## 3.2 编辑

点击目录树右侧的扩展按钮按钮，选择“基本信息”，即可对数据图表/目录的基本信息进行编辑

![编辑](/datart-docs/images/datachart/3-1-2.png)

## 3.3 发布、取消发布

在数据图表浏览界面的工具栏上点击“发布”按钮来发布一个数据图表，未发布前数据图表处理制作中状态，此时对拥有查看权限的成员不可见；发布之后拥有查看权限的成员才能看到

![发布-1](/datart-docs/images/datachart/3-3-1.png)

数据图表发布之后，如果需要下架，从工具栏右侧的扩展菜单中选择“取消发布”，则图表会重新回到制作中状态

![发布-2](/datart-docs/images/datachart/3-3-2.png)

## 3.4 同步数据

如果需要更新图表中的数据，点击工具栏右侧的扩展菜单中的“同步数据”选项

![同步数据-1](/datart-docs/images/datachart/3-4-1.png)

## 3.5 另存为

另存为功能支持将当前图表复制并保存。可以选择从目录树的扩展按钮中对图表进行另存为操作，也可以在工具栏右侧的扩展菜单中找到“另存为”选项

![另存为-1](/datart-docs/images/datachart/3-9-2.png)

![另存为-2](/datart-docs/images/datachart/3-5-1.png)

点击之后，在弹出的对话框中输入新的图表名称和路径，点击保存完成复制

## 3.6 添加到仪表板

该功能支持将当前图表作为组件添加到指定仪表板。可以在工具栏右侧的扩展菜单中找到“添加到仪表板”选项

![添加到仪表板-1](/datart-docs/images/datachart/3-6-1.png)

点击之后，在弹出的对话框中选择想要加入的仪表板

![添加到仪表板-2](/datart-docs/images/datachart/3-6-2.png)

点击确定之后，随即跳转到仪表板编辑页，用户可以对新增的图表组件调整尺寸和样式

![添加到仪表板-3](/datart-docs/images/datachart/3-6-3.png)

## 3.7 分享管理

分享管理功能用于管理当前图表的分享链接。可以在工具栏右侧的扩展菜单中找到“分享管理”选项

![分享管理-1](/datart-docs/images/datachart/3-7-1.png)

点击之后，在弹出的的面板中新建和编辑分享链接

![分享管理-2](/datart-docs/images/datachart/3-7-2.png)

点击右上角的“添加链接”按钮新建一个分享链接，需要输入以下选项

- 截止日期：指定当前分享链接的过期时间；可选项，当不填写时链接永久有效。**需要注意的是，由于截止日期在应用数据库中以 timestamp 类型存储，因此不支持设置 2038 年以后的日期**

- 认证方式：

  - 无：公共分享，任何人都可以访问。数据权限与分享者相同

    ![分享管理-3](/datart-docs/images/datachart/3-7-3.png)

  - 口令：会随链接一同生成一个口令，访问分享链接时需要正确输入口令才能查看内容。数据权限与分享者相同

    ![分享管理-4](/datart-docs/images/datachart/3-7-4.png)

  - 登录：访问分享链接时需要登录查看内容。该认证方式会多出 2 个额外选项

    - 数据权限：可以选择访问链接时所查看数据的权限。当选择“登录者”时，会依照不同的登录者展示符合其自身权限的数据；当选择“分享者”时，所有人访问链接查看到的数据与分享者相同
    - 指定角色/成员：指定能够访问当前分享链接的角色和成员；可选项，当不填写时按照访问用户自身的[权限设定](permission)来展示内容。

    ![分享管理-5](/datart-docs/images/datachart/3-7-5.png)

点击确认之后，生成的分享链接会展示在面板上。可以在面板上快捷复制链接地址、编辑和删除链接

![分享管理-6](/datart-docs/images/datachart/3-7-6.png)

## 3.8 导出数据

datart 支持将数据图表以 Excel、PDF、图片 3 种形式导出，PDF 和图片需要[配置截图服务](index#3-2-5-截图配置)才能正常使用。可以在工具栏右侧的扩展菜单中找到 3 种下载选项

![下载-1](/datart-docs/images/datachart/3-8-1.png)

点击之后会在后台生成下载任务，datart 服务端会异步地执行下载任务，执行完成后将文件生成到配置的文件路径下。下载任务生成时界面顶部会有消息提示

![下载-2](/datart-docs/images/datachart/3-8-2.png)

当有新的下载任务执行完成时，主导航栏下方的“下载列表”图标上会有角标提示；打开下载列表，点击文件名称下载文件

![下载-3](/datart-docs/images/datachart/3-8-3.png)

## 3.9 导入与导出模板

可以将图表配置导出为 `.drt`（datart template file）模板文件，并支持在任意 datart 服务导入模板文件来创建图表

### 3.9.1 导出模板

点击扩展按钮中的“导出为模板”选项，会弹出样例数据编辑面板；datart 会将样例数据存放到模板中供图表展示使用，在该面板中用户可以给样例数据脱敏，或是替换新的样例数据。完成之后，点击确定执行导出任务

![](/datart-docs/images/datachart/template1.png)
![](/datart-docs/images/datachart/template2.png)

导出任务执行完成后，在主导航栏的下载列表下载模板文件

![](/datart-docs/images/datachart/template3.png)

### 3.9.2 导入模板

点击可视化目录顶部的新建按钮，选择“导入模板”，在弹出的表单中输入名称，选择模板文件和路径，点击确定，即可完成导入操作

![](/datart-docs/images/datachart/template4.png)
![](/datart-docs/images/datachart/template5.png)

通过导入模板新建的图表中所展示的是样式数据，如果需要替换为数据视图中的真实数据，还需要手动匹配一下。

打开图表编辑界面，可以看到数据栏中的配置字段呈警告色，说明该项配置与数据视图不匹配。选择数据视图，在弹出的对话框中选择“保留”

![](/datart-docs/images/dashboard/template6.png)
![](/datart-docs/images/dashboard/template7.png)

数据配置项会按照字段名称自动匹配，匹配成功的字段会正常显示，未匹配成功的字段依然呈警告色

![](/datart-docs/images/dashboard/template8.png)

点击数据栏中显示警告色的字段，在下拉菜单中替换为数据视图中的字段，这样就可以保留原始配置信息并切换到数据视图的真实数据了

![](/datart-docs/images/dashboard/template9.png)
![](/datart-docs/images/dashboard/template10.png)

## 3.10 移至回收站、删除目录

在目录树中可以删除目录、以及将数据图表移动到回收站；在数据图表工具栏的扩展菜单中也有移至回收站选项

点击目录树右侧的扩展按钮按钮，如果是目录，会显示`删除`按钮，点击并确认之后会永久删除该目录；如果是数据图表，会显示`移至回收站`按钮，点击并确认之后，该数据图表会被移动到回收站归档，无法再被使用

<p>
  <img width="350" src="/datart-docs/images/datachart/3-9-1.png" alt="回收站-1" />
  <img width="350" src="/datart-docs/images/datachart/3-9-2.png" alt="回收站-2" />
</p>

扩展菜单中的移至回收站按钮

![回收站-3](/datart-docs/images/datachart/3-9-3.png)

## 3.11 还原

点击目录树顶部的扩展按钮，进入回收站

![还原-1](/datart-docs/images/datachart/3-10-1.png)

系统会将移至回收站的数据图表重命名，规则为`原名称.时间戳`；点击回收站列表的任意数据图表，右侧区域会展示该数据图表的详细信息，为只读状态

![还原-2](/datart-docs/images/datachart/3-10-2.png)

点击列表右侧扩展按钮，选择`还原`，在弹窗表单中需要重新填写还原后的名称和目录，填写完成后，点击保存按钮完成还原

![还原-3](/datart-docs/images/datachart/3-10-3.png)

## 3.12 删除

查看回收站列表里的数据图表信息时，点击列表右侧扩展按钮，选择`删除`，确认对话框之后，将会永久删除该数据图表

![删除](/datart-docs/images/datachart/3-11-1.png)

## 3.13 搜索

点击目录树顶部的`搜索`按钮，会弹出关键字搜索框，可以按照名称检索数据图表、仪表板和目录

![搜索](/datart-docs/images/datachart/3-12-1.png)
